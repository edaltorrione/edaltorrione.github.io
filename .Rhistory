est[i] = summary(lm(Y~X))$coefficients[2,2]^2
}
mean(est)
for(i in 1:5000){
X = rnorm(n)
X2 = 1 + 10*X + rnorm(n)
Y = 2 + 3*X + gamma*X^2 + rnorm(n)
XX = cbind(rep(1, n), X)
bo = summary(lm(Y~X))$coefficients
var[i] = bo$coefficients[2,2]^2
est = bo$coefficients[2,1]
}
var = numeric(5000)
summary(lm(Y~X))$coefficients
var = numeric(5000)
for(i in 1:5000){
X = rnorm(n)
X2 = 1 + 10*X + rnorm(n)
Y = 2 + 3*X + gamma*X^2 + rnorm(n)
XX = cbind(rep(1, n), X)
bo = summary(lm(Y~X))$coefficients
var[i] = bo[2,2]^2
est = bo[2,1]
}
bo = solve(t(XX)%*%XX/n)
bo + gamma^2*bo
var(sqrt(n)*est)
est
for(i in 1:5000){
X = rnorm(n)
X2 = 1 + 10*X + rnorm(n)
Y = 2 + 3*X + gamma*X^2 + rnorm(n)
XX = cbind(rep(1, n), X)
bo = summary(lm(Y~X))$coefficients
var[i] = bo[2,2]^2
est[i] = bo[2,1]
}
var(sqrt(n)*est)
mean(est)
est
bo
mean(var)
var(est)
gamma = 5
est = numeric(5000)
n = 10000
var = numeric(5000)
for(i in 1:5000){
X = rnorm(n)
X2 = 1 + 10*X + rnorm(n)
Y = 2 + 3*X + gamma*X^2 + rnorm(n)
XX = cbind(rep(1, n), X)
bo = summary(lm(Y~X))$coefficients
var[i] = bo[2,2]^2
est[i] = bo[2,1]
}
var(est)
mean(est)
mean(var)
bo
for(i in 1:5000){
X = rnorm(n)
X2 = 1 + 10*X + rnorm(n)
Y = 2 + 3*X + gamma*X^2 + rnorm(n)
XX = cbind(rep(1, n), X)
bo = summary(lm(Y~X))$coefficients
var[i] = bo[1,2]^2
est[i] = bo[1,1]
}
var(est)
mean(est)
mean(var)
bo
var(sqrt(n)*est)
est = numeric(5000)
n = 10000
var = numeric(5000)
for(i in 1:5000){
X1 = rnorm(n)
Y = 2 + 3*X1 + gamma*X1^2 + rnorm(n)
XX = cbind(rep(1, n), X)
bo = summary(lm(Y~X))$coefficients
var[i] = bo[1,2]^2
est[i] = bo[1,1]
}
var(sqrt(n)*est)
mean(est)
mean(var)
gamma = 10
est = numeric(5000)
n = 10000
var = numeric(5000)
for(i in 1:5000){
X1 = rnorm(n)
Y = 2 + 3*X1 + gamma*X1^2 + rnorm(n)
XX = cbind(rep(1, n), X)
bo = summary(lm(Y~X))$coefficients
var[i] = bo[1,2]^2
est[i] = bo[1,1]
}
var(sqrt(n)*est)
mean(est)
mean(var)
var = numeric(5000)
for(i in 1:5000){
X1 = rnorm(n, mean = 3)
Y = 2 + 3*X1 + gamma*X1^2 + rnorm(n)
XX = cbind(rep(1, n), X)
bo = summary(lm(Y~X))$coefficients
var[i] = bo[1,2]^2
est[i] = bo[1,1]
}
var(sqrt(n)*est)
mean(est)
mean(var)
bo
mean(est)
mean(var)
var(est)
XX*gamma*X1^2
bu = (XX%*%gamma*X1^2)
(XX%*%gamma*X1^2)
(t(XX)%*%gamma*X1^2)
t(XX)%*%gamma*X1^2
t(XX)
gamma*X1^2
dim(XX)
XX
dim(XX)
length9X1^2
length(X1^2)
bu = (t(XX)%*%X1^2)
gamma*(t(XX)%*%X1^2)
for(i in 1:5000){
X1 = rnorm(n, mean = 3)
Y = 2 + 3*X1 + gamma*X1^2 + rnorm(n)
XX = cbind(rep(1, n), X)
bo = summary(lm(Y~X))$coefficients
var[i] = bo[1,2]^2
est[i] = bo[1,1]
bu[i] = gamma*(t(XX)%*%X1^2)[1]/n
}
mvar(bu)
var(bu)
var(sqrt(n)*bu)
var(est)
for(i in 1:5000){
X1 = rnorm(n, mean = 3)
e = rnorm(n)
Y = 2 + 3*X1 + gamma*X1^2 + e
XX = cbind(rep(1, n), X)
bo = summary(lm(Y~X))$coefficients
var[i] = bo[1,2]^2
est[i] = bo[1,1]
bu[i] = gamma*(t(XX)%*%X1^2)[1]/n + (t(XX)%*%e)[1]/n
}
mean(bu)
var(est)
mean(bu)
var(bu)
for(i in 1:5000){
X1 = rnorm(n, mean = 3)
e = rnorm(n)
Y = 2 + 3*X1 + gamma*X1^2 + e
XX = cbind(rep(1, n), X)
bo = summary(lm(Y~X))$coefficients
var[i] = bo[1,2]^2
est[i] = bo[1,1]
bu[i] = solve(t(XX)%*%XX)%*%(gamma*(t(XX)%*%X1^2)[1]/n + (t(XX)%*%e)[1]/n)
}
bu[i] = solve(t(XX)%*%XX)%*%(gamma*(t(XX)%*%X1^2)/n + (t(XX)%*%e)/n)
solve(t(XX)%*%XX)%*%(gamma*(t(XX)%*%X1^2)/n + (t(XX)%*%e)/n)
for(i in 1:5000){
X1 = rnorm(n, mean = 3)
e = rnorm(n)
Y = 2 + 3*X1 + gamma*X1^2 + e
XX = cbind(rep(1, n), X)
bo = summary(lm(Y~X))$coefficients
var[i] = bo[1,2]^2
est[i] = bo[1,1]
bu[i] = solve(t(XX)%*%XX)%*%(gamma*(t(XX)%*%X1^2)/n + (t(XX)%*%e)/n)[1]
}
for(i in 1:5000){
X1 = rnorm(n, mean = 3)
e = rnorm(n)
Y = 2 + 3*X1 + gamma*X1^2 + e
XX = cbind(rep(1, n), X)
bo = summary(lm(Y~X))$coefficients
var[i] = bo[1,2]^2
est[i] = bo[1,1]
bu[i] = (solve(t(XX)%*%XX)%*%(gamma*(t(XX)%*%X1^2)/n + (t(XX)%*%e)/n))[1]
}
var(est)
var(bu)
for(i in 1:5000){
X1 = rnorm(n, mean = 3)
e = rnorm(n)
Y = 2 + 3*X1 + gamma*X1^2 + e
XX = cbind(rep(1, n), X)
bo = summary(lm(Y~X))$coefficients
var[i] = bo[1,2]^2
est[i] = bo[1,1]
bu[i] = (solve(t(XX)%*%XX)%*%(gamma*(t(XX)%*%X1^2) + (t(XX)%*%e)))[1]
}
var(est)
var(bu)
for(i in 1:5000){
X1 = rnorm(n, mean = 3)
e = rnorm(n)
Y = 2 + 3*X1  + e
XX = cbind(rep(1, n), X)
bo = summary(lm(Y~X))$coefficients
var[i] = bo[1,2]^2
est[i] = bo[1,1]
bu[i] = (solve(t(XX)%*%XX)%*%((t(XX)%*%e)))[1]
}
var(est)
var(bu)
bu = vector(mod = "list", 5000)
for(i in 1:5000){
X1 = rnorm(n, mean = 3)
e = rnorm(n)
Y = 2 + 3*X1  + e
XX = cbind(rep(1, n), X)
bo = summary(lm(Y~X))$coefficients
var[i] = bo[1,2]^2
est[i] = bo[1,1]
bu[[i]] = (solve(t(XX)%*%XX)%*%((t(XX)%*%e)))
}
bu
lm(X~X)
(solve(t(XX)%*%XX)%*%((t(XX)%*%XX)))
(solve(t(XX)%*%XX)%*%((t(XX)%*%X)))
dim(XX)
((t(XX)%*%XX)%*%((t(XX)%*%X)))
((t(XX)%*%XX)%*%((t(XX)%*%XX)))
(solve(t(XX)%*%XX)%*%((t(XX)%*%XX)))
solve(t(XX)%*%XX)
bb = solve(t(XX)%*%XX)
(bb%*%((t(XX)%*%XX)))
bb%*%(t(XX)%*%XX)
bubu = (t(XX)%*%XX)
bubu
bb%8%bubu
bb%*%bubu
(solve(t(XX)%*%XX)%*%((t(XX)%*%X^2)))
lm(X^2~X)
45 - 37
(5/4)^10
1 + 10(0.75 - 0.75^(11))/0.25
1 + 10*(0.75 - 0.75^(11))/0.25
1/2 - 1/4
1 + 10*(0.25 - 0.25^(11))/0.75
1 + 10*(0.25 - 0.25^(10))/0.75
1 + 10*(0.25 - 0.25^(10))/0.75 + 0.25^3
1 + 10*(0.25 - 0.25^(9))/0.75 + 0.25^3
library(Rlab)
c = 1
est = numeric(1000)
sample(c(2*c, c/1), prob = (0.5, 0.5))
sample(c(2*c, c/1), prob = c(0.5, 0.5))
sample(c(2*c, c/1), size = 1, prob = c(0.5, 0.5))
cc = sample(c(2*c, c/1), size = 1, prob = c(0.5, 0.5))
c = 1
est = numeric(1000)
init = 0
n = 10
for(i in 1:1000){
init = c
for(k in 1:n){
cc = sample(c(2*init, init/2), size = 1, prob = c(0.5, 0.5))
init = cc
}
est[i] = init
}
mean(est)
init = 1
k = 1
cc = sample(c(2*init, init/2), size = 1, prob = c(0.5, 0.5))
cc
init = cc
cc = sample(c(2*init, init/2), size = 1, prob = c(0.5, 0.5))
cc
init = cc
cc = sample(c(2*init, init/2), size = 1, prob = c(0.5, 0.5))
init = cc
init
cc = sample(c(2*init, init/2), size = 1, prob = c(0.5, 0.5))
init = cc
init
cc = sample(c(2*init, init/2), size = 1, prob = c(0.5, 0.5))
init = cc
init
cc = sample(c(2*init, init/2), size = 1, prob = c(0.5, 0.5))
init = cc
init
cc = sample(c(2*init, init/2), size = 1, prob = c(0.5, 0.5))
init = cc
init
(5/4)^10
est = numeric(10000)
init = 0
n = 10
for(i in 1:10000){
init = 1
for(k in 1:n){
cc = sample(c(2*init, init/2), size = 1, prob = c(0.5, 0.5))
init = cc
}
est[i] = init
}
mean(est)
(5/4)^10
est = numeric(10000)
init = 0
n = 10
for(i in 1:10000){
init = 1
for(k in 1:3){
cc = sample(c(2*init, init/2), size = 1, prob = c(0.5, 0.5))
init = cc
}
est[i] = init
}
mean(est)
1 + 3*0.25 + 3*0.25^2 + 0.25^3
(5/4)^3
0.25^10
(0.25 - 0.25^10)/(1 - 0.25)
((0.25 - 0.25^10)/(1 - 0.25))*10
est = numeric(1000)
X1 = rnorm(1000000)
X2 = rnorm(1000000)
d = X1*(X2 <= 0 & X1 >= 0 ) + X2*(X1 <= 0 & X2 >= 0) + sqrt(X1^2 + X2^2)*(X1 >= 0 & X2 >= 0)
X1 = rnorm(100000)
X2 = rnorm(100000)
d = X1*(X2 <= 0 & X1 >= 0 ) + X2*(X1 <= 0 & X2 >= 0) + sqrt(X1^2 + X2^2)*(X1 >= 0 & X2 >= 0)
plot(cbind(X1, X2))
points(cbind(X1, X2)[d >0, ], col = "red")
kk = kernel(d/0.5)
plot(cbind(X1, X2))
points(cbind(X1, X2)[d >0, ], col = "red")
points(cbind(X1, X2)[abs(d) < 0.5, ], col = "red")
plot(cbind(X1, X2))
points(cbind(X1, X2)[abs(d) < 0.5, ], col = "red")
points(cbind(X1, X2)[0< abs(d) < 0.5, ], col = "red")
kk = kernel(d/0.5)
plot(cbind(X1, X2))
points(cbind(X1, X2)[abs(d) < 0.5 & abs(d) > 0, ], col = "red")
ii = !(X1 <= 0 | X2 <= 0)
ii
points(cbind(X1, X2)[abs(d) < 0.5 & ii, ], col = "red")
kk = kernel(d/0.5)
plot(cbind(X1, X2))
points(cbind(X1, X2)[abs(d) < 0.5 & ii, ], col = "red")
ii = !(X1 <= 0 & X2 <= 0)
plot(cbind(X1, X2))
points(cbind(X1, X2)[abs(d) < 0.5 & ii, ], col = "red")
kernel1 = function(x){ ( 1 - abs(x))*(abs(x) <= 1)}
dd = k(d/0.5)
dd = kernel1(d/0.5)
dd = kernel1(d/0.5)*ii
plot(cbind(X1, X2))
points(cbind(X1, X2)[dd > 0, ], col = "red")
mean(dd)
mean(dd/h)
mean(dd/0.5)
mean(!ii*dd/0.5)
mean((!ii*dd)/0.5)
mean(dd)
var(dd)
h = 0.2
X = rnorm(1000)
Y = rnorm(1000)
subset = NULL
GG = diag(1000)
if(!is.null(subset)){
Y = Y[subset]
X = X[subset]
GG = GG[subset, subset]
}
nas = is.na(X) | is.na(Y)
X = X[!nas]
Y = Y[!nas]
GG = GG[!nas, !nas]
Z = X >= 0
n = length(Y)
Xp = cbind(rep(1, n), X/h)
omega_h_r = Z*kernel1(X/h, h)
omega_h_l = (!Z)*kernel1(X/h, h)
# kernel1: triangular kernel function.
kernel1 = function(x, h){
k = 1 - abs(x)
k[k < 0 ] = 0
k = k/h
return(k)
}
omega_h_r = Z*kernel1(X/h, h)
omega_h_l = (!Z)*kernel1(X/h, h)
w_h_r = omega_h_r > 0
w_h_l = omega_h_l > 0
GG_h_r = GG[w_h_r, w_h_r]
GG_h_l = GG[w_h_l, w_h_l]
GG_h_l_r = GG[w_h_r, w_h_l]
gamma_h_r = t(Xp)%*%(Xp*omega_h_r)/n
gamma_h_l = t(Xp)%*%(Xp*omega_h_l)/n
gamma_h_r_inv = solve(gamma_h_r)
gamma_h_l_inv = solve(gamma_h_l)
Hp = diag(c(1, 1/h))
beta_plus = Hp%*%gamma_h_r_inv%*%t(Xp)%*%(omega_h_r*Y)/n
beta_minus = Hp%*%gamma_h_l_inv%*%t(Xp)%*%(omega_h_l*Y)/n
beta_plus
gamma_h_r_inv%*%t(Xp)%*%(omega_h_r*Y)/n
bo = rdrobust::rdrobust(X,Y)
bo$Estimate
bo$beta_Y_p_r
bo$beta_Y_p_l
estimate_conv = function(h, X, Y, GG, subset = NULL){
if(!is.null(subset)){
Y = Y[subset]
X = X[subset]
GG = GG[subset, subset]
}
nas = is.na(X) | is.na(Y)
X = X[!nas]
Y = Y[!nas]
GG = GG[!nas, !nas]
Z = X >= 0
n = length(Y)
Xp = cbind(rep(1, n), X/h)
omega_h_r = Z*kernel1(X/h, h)
omega_h_l = (!Z)*kernel1(X/h, h)
w_h_r = omega_h_r > 0
w_h_l = omega_h_l > 0
GG_h_r = GG[w_h_r, w_h_r]
GG_h_l = GG[w_h_l, w_h_l]
GG_h_l_r = GG[w_h_r, w_h_l]
gamma_h_r = t(Xp)%*%(Xp*omega_h_r)/n
gamma_h_l = t(Xp)%*%(Xp*omega_h_l)/n
gamma_h_r_inv = solve(gamma_h_r)
gamma_h_l_inv = solve(gamma_h_l)
Hp = diag(c(1, 1/h))
beta_plus = Hp%*%gamma_h_r_inv%*%t(Xp)%*%(omega_h_r*Y)/n
beta_minus = Hp%*%gamma_h_l_inv%*%t(Xp)%*%(omega_h_l*Y)/n
XX = cbind(rep(1,n), X)
# Residuals
res_r = Y - XX%*%beta_plus
res_l = Y - XX%*%beta_minus
# Variance \hat{mu}_{d,g}(h) and \hat{mu}_{d',g'}(h)
M_h_r = (omega_h_r*Xp*as.vector(res_r))[w_h_r,]
M_h_l = (omega_h_l*Xp*as.vector(res_l))[w_h_l,]
psi_h_r = crossprod(M_h_r, as.matrix(GG_h_r%*%M_h_r))/n
psi_h_l = crossprod(M_h_l, as.matrix(GG_h_l%*%M_h_l))/n
psi_h_l_r = crossprod(M_h_r, as.matrix(GG_h_l_r%*%M_h_l))/n
V_h_r =  Hp%*%gamma_h_r_inv%*%psi_h_r%*%gamma_h_r_inv%*%Hp/n
V_h_l =  Hp%*%gamma_h_l_inv%*%psi_h_l%*%gamma_h_l_inv%*%Hp/n
V_h_l_r = Hp%*%gamma_h_r_inv%*%psi_h_l_r%*%gamma_h_l_inv%*%Hp/n
# Final variance estimate
V_r = V_h_r[1,1]
V_l = V_h_l[1,1]
C_r_l = V_h_l_r[1,1]
V = V_r + V_l - 2*C_r_l
tau = beta_plus[1] - beta_minus[1]
# Effective sample size
N_r = sum(omega_h_r != 0)
N_l = sum(omega_h_l != 0)
return(list(est = tau,
var = V,
N_r = N_r,
N_l = N_l,
V_r = V_r,
V_l = V_l,
C_r_l = C_r_l,
beta_plus = beta_plus,
beta_minus = beta_minus,
GG_h_r = GG_h_r,
GG_h_l = GG_h_l))
}
beta_plus
bo = rdrobust::rdrobust(Y,X, h = h)
bo$beta_Y_p_r
beta_plus
beta_plus2 = gamma_h_r_inv%*%t(Xp)%*%(omega_h_r*Y)/n
res1 =   res_r = Y - XX%*%beta_plus
XX = cbind(rep(1,n), X)
res1 = Y - XX%*%beta_plus
res2 = Y - Xp%*%beta_plus2
res2
head(res2)
head(res1)
all(res1 == res2)
which(res1 != res2)
res1[3]
res2[3]
res2[3] == res1[3]
solve(t(XX)%*%w_h_r%*%XX)t(XX)%*%w_h_r%*%Y
solve(t(XX)%*%w_h_r%*%XX)%*%t(XX)%*%w_h_r%*%Y
solve(t(XX)%*%XX*w_h_r)%*%t(XX)%*%w_h_r%*%Y
solve(t(XX)%*%(XX*w_h_r))%*%t(XX)%*%w_h_r%*%Y
solve(t(XX)%*%(XX*omega_h_r))%*%t(XX)%*%(omega_h_r*Y)/n
Hp%*%solve(t(XX)%*%(XX*omega_h_r))%*%t(XX)%*%(omega_h_r*Y)/n
beta_plus
omega_h_r
W_r = diag(omega_h_r)
W_r
solve(t(XX)%*%W_r%*%XX)%*%t(XX)%*%W_r%*%Y
Hp%*%solve(t(Xp)%*%W_r%*%Xp)%*%t(Xp)%*%W_r%*%Y
diag(c(1,2,3,4,5))
dd = diag(c(1,2,3,4,5))
t(c(1, 0,0,0,0))%*%dd
setwd("C:\\Users\\ed659\\OneDrive - Yale University\\Documents\\GitHub\\academicpages.github.io")
list.files()
